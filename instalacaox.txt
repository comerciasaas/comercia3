# GUIA COMPLETO DE INSTALAÇÃO E DEPLOY - SISTEMA DINÂMICA
# Versão: 2.0.0 - Sistema Completo de Barbearia com IA

## 🚀 O QUE FALTA PARA FUNCIONAR COMPLETAMENTE

### 1. CONFIGURAÇÕES OBRIGATÓRIAS
- ✅ **MySQL Database** - Já configurado localmente
- ✅ **Node.js 18+** - Já instalado
- ⚠️ **API Key do Gemini** - NECESSÁRIA para Chat IA funcionar
- ⚠️ **Configuração de Produção** - Para deploy no IONOS

### 2. API KEYS NECESSÁRIAS
```
GOOGLE_GEMINI_API_KEY=sua-chave-aqui
```
**Como obter:** https://makersuite.google.com/app/apikey

### 3. CONFIGURAÇÕES OPCIONAIS (Para funcionalidades extras)
```
OPENAI_API_KEY=sk-proj-sua-chave-openai
HUGGINGFACE_API_KEY=hf_sua-chave-huggingface
WHATSAPP_ACCESS_TOKEN=seu-token-whatsapp
```

## 🌐 DEPLOY NO IONOS - GUIA COMPLETO

### PASSO 1: PREPARAR O PROJETO PARA PRODUÇÃO

#### 1.1 Criar arquivo de produção
```bash
# Criar .env.production
cp server/.env server/.env.production
```

#### 1.2 Configurar variáveis de produção
```env
# server/.env.production
NODE_ENV=production
PORT=3001

# Database (IONOS MySQL)
DB_HOST=seu-host-mysql.ionos.com
DB_PORT=3306
DB_USER=seu-usuario-mysql
DB_PASSWORD=sua-senha-mysql
DB_NAME=dinamica_saas

# JWT
JWT_SECRET=sua-chave-jwt-super-segura-aqui-2025

# API Keys
GOOGLE_GEMINI_API_KEY=sua-chave-gemini-aqui
OPENAI_API_KEY=sk-proj-sua-chave-openai-aqui
HUGGINGFACE_API_KEY=hf_sua-chave-huggingface-aqui

# Security
SESSION_SECRET=sua-chave-sessao-super-segura-2025
ENCRYPTION_KEY=sua-chave-32-caracteres-aqui-2025

# CORS (seu domínio)
CORS_ORIGIN=https://seudominio.com
```

#### 1.3 Build do projeto
```bash
# Build do frontend
npm run build

# Testar build localmente
npm run preview
```

### PASSO 2: CONFIGURAR BANCO DE DADOS NO IONOS

#### 2.1 Bancos de Dados Suportados pelo IONOS:
- ✅ **MySQL 8.0** (Recomendado - já implementado)
- ✅ **MariaDB** (Compatível com MySQL)
- ✅ **PostgreSQL** (Requer migração)

#### 2.2 Configurar MySQL no IONOS:
1. **Acesse o painel IONOS**
2. **Vá em "Banco de Dados"**
3. **Crie um novo banco MySQL**
4. **Anote as credenciais:**
   - Host: `mysql-xxxx.ionos.com`
   - Usuário: `seu_usuario`
   - Senha: `sua_senha`
   - Database: `dinamica_saas`

#### 2.3 Migrar dados para IONOS:
```bash
# Exportar banco local
mysqldump -u root -p dinamica_saas > backup_local.sql

# Importar no IONOS (via phpMyAdmin ou linha de comando)
mysql -h mysql-xxxx.ionos.com -u seu_usuario -p dinamica_saas < backup_local.sql
```

### PASSO 3: DEPLOY NO IONOS

#### 3.1 Opções de Deploy no IONOS:

##### OPÇÃO A: IONOS Cloud Server (VPS)
```bash
# 1. Conectar via SSH
ssh root@seu-servidor.ionos.com

# 2. Instalar Node.js
curl -fsSL https://deb.nodesource.com/setup_18.x | sudo -E bash -
sudo apt-get install -y nodejs

# 3. Instalar PM2
npm install -g pm2

# 4. Clonar projeto
git clone seu-repositorio.git
cd dinamica-saas

# 5. Instalar dependências
npm install

# 6. Configurar ambiente
cp server/.env.production server/.env

# 7. Setup do banco
npm run setup-db

# 8. Build
npm run build

# 9. Iniciar com PM2
pm2 start ecosystem.config.js
pm2 save
pm2 startup
```

##### OPÇÃO B: IONOS Hosting Compartilhado
```bash
# 1. Build local
npm run build

# 2. Upload via FTP:
# - Pasta 'dist/' para public_html/
# - Pasta 'server/' para pasta privada
# - Configurar Node.js no painel IONOS
```

#### 3.2 Configurar PM2 (para VPS)
```javascript
// ecosystem.config.js
module.exports = {
  apps: [{
    name: 'dinamica-saas',
    script: 'server/app.js',
    instances: 'max',
    exec_mode: 'cluster',
    env: {
      NODE_ENV: 'production',
      PORT: 3001
    },
    error_file: './logs/err.log',
    out_file: './logs/out.log',
    log_file: './logs/combined.log',
    time: true
  }]
};
```

#### 3.3 Configurar Nginx (Proxy Reverso)
```nginx
# /etc/nginx/sites-available/dinamica-saas
server {
    listen 80;
    server_name seudominio.com www.seudominio.com;
    
    # Redirecionar para HTTPS
    return 301 https://$server_name$request_uri;
}

server {
    listen 443 ssl http2;
    server_name seudominio.com www.seudominio.com;
    
    # SSL (Let's Encrypt)
    ssl_certificate /etc/letsencrypt/live/seudominio.com/fullchain.pem;
    ssl_certificate_key /etc/letsencrypt/live/seudominio.com/privkey.pem;
    
    # Frontend estático
    location / {
        root /var/www/dinamica-saas/dist;
        try_files $uri $uri/ /index.html;
        
        # Cache para assets
        location ~* \.(js|css|png|jpg|jpeg|gif|ico|svg)$ {
            expires 1y;
            add_header Cache-Control "public, immutable";
        }
    }
    
    # API Backend
    location /api {
        proxy_pass http://localhost:3001;
        proxy_http_version 1.1;
        proxy_set_header Upgrade $http_upgrade;
        proxy_set_header Connection 'upgrade';
        proxy_set_header Host $host;
        proxy_set_header X-Real-IP $remote_addr;
        proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
        proxy_set_header X-Forwarded-Proto $scheme;
        proxy_cache_bypass $http_upgrade;
    }
    
    # WebSocket
    location /socket.io {
        proxy_pass http://localhost:3001;
        proxy_http_version 1.1;
        proxy_set_header Upgrade $http_upgrade;
        proxy_set_header Connection "upgrade";
        proxy_set_header Host $host;
        proxy_set_header X-Real-IP $remote_addr;
        proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
        proxy_set_header X-Forwarded-Proto $scheme;
    }
}
```

### PASSO 4: CONFIGURAR SSL (HTTPS)

#### 4.1 Instalar Certbot
```bash
sudo apt install certbot python3-certbot-nginx
```

#### 4.2 Obter certificado SSL
```bash
sudo certbot --nginx -d seudominio.com -d www.seudominio.com
```

#### 4.3 Renovação automática
```bash
sudo crontab -e
# Adicionar linha:
0 12 * * * /usr/bin/certbot renew --quiet
```

### PASSO 5: MONITORAMENTO E LOGS

#### 5.1 Configurar logs
```bash
# Criar diretório de logs
mkdir -p /var/www/dinamica-saas/logs

# Configurar logrotate
sudo nano /etc/logrotate.d/dinamica-saas
```

#### 5.2 Monitoramento PM2
```bash
# Ver status
pm2 status

# Ver logs
pm2 logs dinamica-saas

# Monitoramento em tempo real
pm2 monit
```

## 🔧 MIGRAÇÃO DE BANCO DE DADOS

### OPÇÃO 1: Manter MySQL (Recomendado)
```sql
-- Já implementado, apenas migrar dados
-- Usar mysqldump conforme mostrado acima
```

### OPÇÃO 2: Migrar para PostgreSQL
```bash
# 1. Instalar PostgreSQL
sudo apt install postgresql postgresql-contrib

# 2. Converter schema MySQL para PostgreSQL
# (Requer modificações no código)

# 3. Atualizar database.js para PostgreSQL
npm install pg
```

### OPÇÃO 3: Usar SQLite (Para testes)
```bash
# 1. Instalar SQLite
npm install sqlite3

# 2. Modificar database.js
# (Não recomendado para produção)
```

## 📊 CHECKLIST DE DEPLOY

### ✅ Pré-Deploy:
- [ ] Build do frontend funciona
- [ ] Testes locais passam
- [ ] Variáveis de ambiente configuradas
- [ ] Banco de dados criado no IONOS
- [ ] API Keys obtidas

### ✅ Deploy:
- [ ] Código enviado para servidor
- [ ] Dependências instaladas
- [ ] Banco de dados migrado
- [ ] PM2 configurado
- [ ] Nginx configurado
- [ ] SSL configurado

### ✅ Pós-Deploy:
- [ ] Site acessível via HTTPS
- [ ] API funcionando
- [ ] Chat IA respondendo
- [ ] Agendamentos sendo criados
- [ ] Logs funcionando

## 🚨 TROUBLESHOOTING

### Problema: "Cannot connect to database"
```bash
# Verificar conexão
mysql -h mysql-xxxx.ionos.com -u usuario -p

# Verificar firewall
sudo ufw allow 3306
```

### Problema: "API Key not working"
```bash
# Testar API Key
curl -H "Authorization: Bearer SUA_API_KEY" \
  https://generativelanguage.googleapis.com/v1beta/models
```

### Problema: "PM2 not starting"
```bash
# Ver logs detalhados
pm2 logs dinamica-saas --lines 100

# Reiniciar
pm2 restart dinamica-saas
```

## 💰 CUSTOS ESTIMADOS IONOS

### VPS Cloud Server:
- **S:** €4/mês - 1 vCore, 1GB RAM (Básico)
- **M:** €8/mês - 2 vCore, 4GB RAM (Recomendado)
- **L:** €16/mês - 4 vCore, 8GB RAM (Alto tráfego)

### Banco de Dados MySQL:
- **Incluído** no VPS
- **Ou separado:** €5-15/mês

### Domínio:
- **€12/ano** (.com)

### SSL:
- **Gratuito** (Let's Encrypt)

**TOTAL ESTIMADO: €15-25/mês**

## 📞 SUPORTE

### Documentação IONOS:
- https://www.ionos.com/help/
- https://www.ionos.com/digitalguide/

### Suporte Técnico:
- Chat: 24/7 disponível
- Telefone: Suporte em português
- Email: Tickets de suporte

## 🎯 RESUMO EXECUTIVO

**PARA COLOCAR O SISTEMA NO AR:**

1. **Obter API Key do Gemini** (5 minutos)
2. **Contratar VPS IONOS** (€8/mês)
3. **Configurar MySQL no IONOS** (30 minutos)
4. **Deploy via SSH** (1 hora)
5. **Configurar domínio e SSL** (30 minutos)

**TOTAL: 2 horas + €8/mês**

**SISTEMA ESTARÁ 100% FUNCIONAL EM PRODUÇÃO**